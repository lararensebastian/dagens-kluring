<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dagens kluring</title>
  <style>
    :root{
      --bg1:#2b153f; --bg2:#1e0f2e;
      --card:#140b24ee; --text:#f3f4f6; --muted:#c4b5fd;
      --accent:#a78bfa; --border:#3b1b5f;
      --shadow:0 20px 60px rgba(0,0,0,.45); --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 20% 10%, rgba(167,139,250,.22), transparent 60%),
        radial-gradient(900px 500px at 80% 30%, rgba(236,72,153,.12), transparent 60%),
        linear-gradient(160deg, var(--bg1), var(--bg2));
      display:flex; align-items:center; justify-content:center;
      padding:24px;
    }
    .wrap{width:min(920px,100%)}
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:28px;
      backdrop-filter: blur(10px);
    }
    header{
      display:flex; align-items:flex-start; justify-content:space-between;
      gap:16px; margin-bottom:18px;
    }
    h1{margin:0; font-size:22px; letter-spacing:.2px}
    .meta{ text-align:right; color:var(--muted); font-size:14px; line-height:1.4; white-space:nowrap; }
    .badge{
      display:inline-flex; gap:8px; align-items:center;
      padding:6px 10px; border:1px solid var(--border);
      border-radius:999px; color:var(--muted); font-size:13px; margin-top:8px;
    }
    .dot{
      width:8px;height:8px;border-radius:999px;background:var(--accent);
      box-shadow:0 0 0 4px rgba(167,139,250,.15);
    }
    .row{
      display:flex; gap:10px; flex-wrap:wrap; margin:14px 0 10px;
      color:var(--muted); font-size:13px;
    }
    .pill{
      border:1px solid rgba(59,27,95,.75);
      background:rgba(2,6,23,.16);
      padding:6px 10px; border-radius:999px;
    }
    .task{
      font-size:19px; line-height:1.55;
      padding:16px; border-radius:14px;
      background:rgba(2,6,23,.20);
      border:1px solid rgba(59,27,95,.75);
      white-space:pre-wrap;
    }
    .btnRow{
      margin-top:12px;
      display:flex; gap:10px; flex-wrap:wrap;
    }
    button{
      cursor:pointer;
      border:1px solid rgba(59,27,95,.75);
      background:rgba(2,6,23,.16);
      color:#f3f4f6;
      padding:10px 14px;
      border-radius:12px;
      font-size:14px;
    }
    button.secondary{ background:transparent; color:var(--muted); }
    button:hover{transform:translateY(-1px)}
    details{
      margin-top:12px;
      border:1px solid rgba(59,27,95,.75);
      border-radius:14px;
      background:rgba(2,6,23,.16);
      padding:12px 14px;
    }
    summary{ cursor:pointer; color:var(--muted); font-size:14px; list-style:none; }
    summary::-webkit-details-marker{display:none}
    .help{ margin-top:10px; font-size:15px; line-height:1.5; opacity:.95; white-space:pre-wrap; }
    .footer{
      margin-top:14px; display:flex; justify-content:space-between; gap:12px;
      color:var(--muted); font-size:13px; flex-wrap:wrap;
    }
    a{color:var(--muted); text-decoration:none}
    a:hover{text-decoration:underline}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <header>
        <div>
          <h1>Dagens kluring</h1>
          <div class="badge"><span class="dot"></span><span>Gåta · Anagram · Logik · Ord</span></div>
        </div>
        <div class="meta">
          <div id="dateText"></div>
          <div id="dayInfo"></div>
        </div>
      </header>

      <div class="row">
        <div class="pill" id="typePill">Typ: …</div>
        <div class="pill" id="timePill">Tid: 5–10 min</div>
      </div>

      <div class="task" id="taskText">Laddar…</div>

      <div class="btnRow">
        <button id="newTaskBtn">Ny kluring</button>
        <button id="resetBtn" class="secondary">Tillbaka till dagens</button>
      </div>

      <details>
        <summary>Visa facit / ledtråd</summary>
        <div class="help" id="helpText"></div>
      </details>

      <div class="footer">
        <div><a href="../">← Till ämnesval</a></div>
        <div id="seedInfo"></div>
      </div>
    </div>
  </div>

<script>
/* ---------- RNG helpers ---------- */
function dayOfYear(date) {
  const start = new Date(date.getFullYear(), 0, 0);
  const diff = date - start;
  const oneDay = 24 * 60 * 60 * 1000;
  return Math.floor(diff / oneDay);
}
function mulberry32(seed) {
  return function() {
    let t = seed += 0x6D2B79F5;
    t = Math.imul(t ^ (t >>> 15), t | 1);
    t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
    return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
  };
}
function randInt(rng, min, max) { return Math.floor(rng() * (max - min + 1)) + min; }
function pick(rng, arr) { return arr[randInt(rng, 0, arr.length - 1)]; }
function shuffle(rng, arr){
  const a = arr.slice();
  for (let i=a.length-1;i>0;i--){
    const j = randInt(rng,0,i);
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}

/* ---------- Date seed ---------- */
const today = new Date();
const y = today.getFullYear();
let doy = dayOfYear(today);
if (doy === 366) doy = 365;
const seed = y * 1000 + doy;
const rngDay = mulberry32(seed);

/* ---------- Generators ---------- */
function makeRiddle(rng){
  const riddles = [
    {q:"Vad kan gå upp men aldrig gå ner?", a:"Din ålder."},
    {q:"Jag har nycklar men inga lås. Jag har plats men inga rum. Vad är jag?", a:"Ett tangentbord."},
    {q:"Vad blir blötare ju mer du torkar?", a:"En handduk."},
    {q:"Jag kan resa runt världen men stannar i ett hörn. Vad är jag?", a:"Ett frimärke."},
    {q:"Vad måste brytas innan det kan användas?", a:"Ett ägg."}
  ];
  const r = pick(rng, riddles);
  return {
    type:"Gåta",
    time:"5–10 min",
    text:`Gåta:\n${r.q}\n\nUppgift:\nSkriv ditt svar + en mening som förklarar hur du tänker.`,
    help:`Facit: ${r.a}\nTips: Förklaringen är viktigare än att ha rätt direkt.`
  };
}

function makeAnagram(rng){
  const words = [
    ["SOMMAR","sommaren / årstid"],
    ["SKOLAN","platsen ni är på"],
    ["DATORN","verktyg i klassrum"],
    ["MUSIKEN","du kan lyssna på"],
    ["FRUKOST","första målet ofta"],
    ["KALENDER","håller koll på dagar"],
    ["VÄNNER","människor du gillar"]
  ];
  const [w, hint] = pick(rng, words);
  const letters = shuffle(rng, w.split("")).join(" ");
  return {
    type:"Anagram",
    time:"5–10 min",
    text:`Anagram:\nBokstäver: ${letters}\n\nUppgift:\n1) Hitta ordet.\n2) Skriv en mening med ordet.`,
    help:`Ledtråd: ${hint}\nFacit: ${w}`
  };
}

function makeWordLogic(rng){
  const patterns = [
    {q:"Vilket ord passar bäst?\n\nVarm → Het\nKall → ____", a:"Iskall / Frusen (vanligast: Frusen)"},
    {q:"Vilket ord passar bäst?\n\nSpringa → Snabbt\nSmyga → ____", a:"Tyst / Försiktigt"},
    {q:"Vilket ord passar bäst?\n\nLäsa → Bok\nLyssna → ____", a:"Musik / Podcast"},
    {q:"Vilket ord passar bäst?\n\nPenna → Skriva\nSax → ____", a:"Klippa"}
  ];
  const p = pick(rng, patterns);
  return {
    type:"Ordlogik",
    time:"5–10 min",
    text:`Ordlogik:\n${p.q}\n\nUppgift:\nSkriv ditt svar och förklara kort varför det passar.`,
    help:`Möjligt facit: ${p.a}\nDet kan finnas fler rimliga svar – motiveringen avgör.`
  };
}

function makeLogicMini(rng){
  const a = randInt(rng, 1, 9);
  const b = randInt(rng, 1, 9);
  const c = a + b;
  return {
    type:"Logik (mini)",
    time:"5–10 min",
    text:`Logik:\nDu tänker på ett tal.\nOm du dubblerar det och lägger till ${b} får du ${2*a + b}.\n\nUppgift:\nVilket tal tänkte du på? Visa med 2 rader.`,
    help:`Facit: ${a}\nLösning: 2x + ${b} = ${2*a + b} ⇒ 2x = ${2*a} ⇒ x = ${a}`
  };
}

function makePattern(rng){
  const start = randInt(rng, 2, 9);
  const step1 = pick(rng, [2,3,4,5]);
  const step2 = pick(rng, [1,2,3]);
  const seq = [start, start+step1, start+step1+step2, start+step1+2*step2];
  return {
    type:"Mönster",
    time:"5–10 min",
    text:`Mönster:\nFyll i nästa två tal:\n${seq[0]}, ${seq[1]}, ${seq[2]}, ${seq[3]}, __, __\n\nUppgift:\nSkriv nästa två tal + skriv regeln med ord.`,
    help:`Ett möjligt svar: fortsätt med +${step2}.\nObs: Om du hittar en annan rimlig regel, skriv den.`
  };
}

const GENERATORS = [makeRiddle, makeAnagram, makeWordLogic, makeLogicMini, makePattern];

function generate(rng){
  const g = pick(rng, GENERATORS);
  return g(rng);
}

/* ---------- Render ---------- */
function render(t){
  document.getElementById("typePill").textContent = `Typ: ${t.type}`;
  document.getElementById("timePill").textContent = `Tid: ${t.time}`;
  document.getElementById("taskText").textContent = t.text;
  document.getElementById("helpText").textContent = t.help || "";
}

const todays = generate(rngDay);

// header/footer
const months = ["januari","februari","mars","april","maj","juni","juli","augusti","september","oktober","november","december"];
document.getElementById("dateText").textContent =
  `${today.getDate()} ${months[today.getMonth()]} ${today.getFullYear()}`;
document.getElementById("dayInfo").textContent = `Dag ${doy} av 365`;
document.getElementById("seedInfo").textContent =
  `Kod: ${y}-${String(today.getMonth()+1).padStart(2,"0")}-${String(today.getDate()).padStart(2,"0")}`;

render(todays);

// buttons
const counterKey = `klur_extra_counter_${y}_${doy}`;
let counter = Number(localStorage.getItem(counterKey) || "0");

document.getElementById("newTaskBtn").addEventListener("click", () => {
  counter += 1;
  localStorage.setItem(counterKey, String(counter));

  const extraSeed = seed * 100000 + counter * 19 + 433;
  const rngExtra = mulberry32(extraSeed);

  render(generate(rngExtra));
});

document.getElementById("resetBtn").addEventListener("click", () => render(todays));
</script>
</body>
</html>
