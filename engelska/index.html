<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dagens engelskauppgift (IM)</title>
  <style>
    :root{
      --bg1:#2b153f; --bg2:#1e0f2e;
      --card:#140b24ee; --text:#f3f4f6; --muted:#c4b5fd;
      --accent:#a78bfa; --border:#3b1b5f;
      --shadow:0 20px 60px rgba(0,0,0,.45); --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 20% 10%, rgba(167,139,250,.22), transparent 60%),
        radial-gradient(900px 500px at 80% 30%, rgba(236,72,153,.12), transparent 60%),
        linear-gradient(160deg, var(--bg1), var(--bg2));
      display:flex; align-items:center; justify-content:center;
      padding:24px;
    }
    .wrap{width:min(920px,100%)}
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:28px;
      backdrop-filter: blur(10px);
    }
    header{
      display:flex; align-items:flex-start; justify-content:space-between;
      gap:16px; margin-bottom:18px;
    }
    h1{margin:0; font-size:22px; letter-spacing:.2px}
    .meta{ text-align:right; color:var(--muted); font-size:14px; line-height:1.4; white-space:nowrap; }
    .badge{
      display:inline-flex; gap:8px; align-items:center;
      padding:6px 10px; border:1px solid var(--border);
      border-radius:999px; color:var(--muted); font-size:13px; margin-top:8px;
    }
    .dot{
      width:8px;height:8px;border-radius:999px;background:var(--accent);
      box-shadow:0 0 0 4px rgba(167,139,250,.15);
    }
    .typeRow{
      display:flex; gap:10px; flex-wrap:wrap; margin:14px 0 10px;
      color:var(--muted); font-size:13px;
    }
    .pill{
      border:1px solid rgba(59,27,95,.75);
      background:rgba(2,6,23,.16);
      padding:6px 10px; border-radius:999px;
    }
    .task{
      font-size:19px; line-height:1.55;
      padding:16px; border-radius:14px;
      background:rgba(2,6,23,.20);
      border:1px solid rgba(59,27,95,.75);
      white-space:pre-wrap;
    }
    .btnRow{
      margin-top:12px;
      display:flex; gap:10px; flex-wrap:wrap;
    }
    button{
      cursor:pointer;
      border:1px solid rgba(59,27,95,.75);
      background:rgba(2,6,23,.16);
      color:#f3f4f6;
      padding:10px 14px;
      border-radius:12px;
      font-size:14px;
    }
    button.secondary{
      background:transparent;
      color:var(--muted);
    }
    button:hover{transform:translateY(-1px)}
    details{
      margin-top:12px;
      border:1px solid rgba(59,27,95,.75);
      border-radius:14px;
      background:rgba(2,6,23,.16);
      padding:12px 14px;
    }
    summary{ cursor:pointer; color:var(--muted); font-size:14px; list-style:none; }
    summary::-webkit-details-marker{display:none}
    .help{ margin-top:10px; font-size:15px; line-height:1.5; opacity:.95; white-space:pre-wrap; }
    .footer{
      margin-top:14px; display:flex; justify-content:space-between; gap:12px;
      color:var(--muted); font-size:13px; flex-wrap:wrap;
    }
    a{color:var(--muted); text-decoration:none}
    a:hover{text-decoration:underline}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <header>
        <div>
          <h1>Dagens engelskauppgift</h1>
          <div class="badge"><span class="dot"></span><span>IM · Lätt att komma igång · 5–10 min</span></div>
        </div>
        <div class="meta">
          <div id="dateText"></div>
          <div id="dayInfo"></div>
        </div>
      </header>

      <div class="typeRow">
        <div class="pill" id="typePill">Type: …</div>
        <div class="pill" id="timePill">Time: 5–10 min</div>
      </div>

      <div class="task" id="taskText">Loading…</div>

      <div class="btnRow">
        <button id="newTaskBtn">Ny uppgift</button>
        <button id="resetBtn" class="secondary">Tillbaka till dagens</button>
      </div>

      <details>
        <summary>Visa lärarstöd</summary>
        <div class="help" id="helpText"></div>
      </details>

      <div class="footer">
        <div><a href="../">← Till ämnesval</a></div>
        <div id="seedInfo"></div>
      </div>
    </div>
  </div>

<script>
/* ---------- Date + seed ---------- */
function dayOfYear(date) {
  const start = new Date(date.getFullYear(), 0, 0);
  const diff = date - start;
  const oneDay = 24 * 60 * 60 * 1000;
  return Math.floor(diff / oneDay);
}
function mulberry32(seed) {
  return function() {
    let t = seed += 0x6D2B79F5;
    t = Math.imul(t ^ (t >>> 15), t | 1);
    t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
    return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
  };
}
function randInt(rng, min, max) { return Math.floor(rng() * (max - min + 1)) + min; }
function pick(rng, arr) { return arr[randInt(rng, 0, arr.length - 1)]; }

const today = new Date();
const y = today.getFullYear();
let doy = dayOfYear(today);
if (doy === 366) doy = 365;

// Seed för "dagens"
const seed = y * 1000 + doy;
const rngDay = mulberry32(seed);

/* ---------- Types ---------- */
const TYPES = [
  { key:"quick",     label:"Quick talk/write",  time:"5–10 min" },
  { key:"choose",    label:"Choose A or B",     time:"5–10 min" },
  { key:"grammar",   label:"Grammar (easy)",    time:"5–10 min" },
  { key:"vocab",     label:"Word of the day",   time:"5–10 min" },
  { key:"fix",       label:"Fix + build (mini)",time:"5–10 min" },
  { key:"reading",   label:"Mini reading",      time:"5–10 min" },
  { key:"practical", label:"Practical English", time:"5–10 min" },
];

/* ---------- Generators (IM-friendly) ---------- */
function makeQuick(rng){
  const topics = [
    "your weekend", "your morning", "a song you like", "a TV show you watch",
    "a place you want to visit", "something you are good at", "your phone habits"
  ];
  const t = pick(rng, topics);
  const frames = [
`Write 3 short sentences about ${t}.
Use these starters:
1) Today I…
2) I like / don’t like…
3) Because…`,
`Write 4 short sentences about ${t}.
Use: and / but / because (at least 2 of them).`,
`Write 3 sentences:
1) I usually…
2) Yesterday I…
3) Tomorrow I will…`
  ];
  return {
    type:"Quick talk/write",
    time:"5–10 min",
    q:pick(rng, frames),
    help:`Goal: get started fast.
Accept short sentences.
If stuck: allow Swedish words inside the sentence and translate 1 key word.`
  };
}

function makeChoose(rng){
  const statements = [
    "School should start later.",
    "Homework is helpful.",
    "Phones should be away during lessons.",
    "It is better to study alone than in a group.",
    "AI tools can help students learn."
  ];
  const s = pick(rng, statements);
  return {
    type:"Choose A or B",
    time:"5–10 min",
    q:`Statement:
${s}

Choose A or B and complete the sentences:
A) I agree because __________.
B) I don’t agree because __________.

Then add ONE more sentence:
Another reason is __________.`,
    help:`Keep it simple: 2–3 sentences is enough.
If needed: let them speak first, then write.`
  };
}

function makeGrammar(rng){
  const tasks = [
    {
      name:"Past tense (easy)",
      q:`Rewrite in past tense:
1) I go to school.
2) We eat lunch.
3) She watches videos.

Bonus: Write ONE sentence about yesterday.`,
      help:`Support:
go→went, eat→ate, watch→watched (often +ed).
One correct sentence is a win.`
    },
    {
      name:"Questions",
      q:`Make questions:
1) You like pizza.
2) They are tired.
3) He plays football.

Bonus: Write ONE question to a classmate.`,
      help:`Support:
Do/Does…? Are…? What/Where/When…?
Example: Do you like pizza?`
    },
    {
      name:"There is / There are",
      q:`Choose: there is / there are
1) ____ a problem.
2) ____ two chairs.
3) ____ many people here.

Bonus: Write ONE sentence about this room.`,
      help:`there is + singular
there are + plural`
    },
    {
      name:"Comparatives",
      q:`Complete with the comparative:
1) This is (easy) __________ than yesterday.
2) My bag is (heavy) __________ than yours.
3) This movie is (good) __________ than that one.

Bonus: Write ONE comparative sentence.`,
      help:`easy→easier, heavy→heavier, good→better`
    }
  ];
  const t = pick(rng, tasks);
  return { type:`Grammar: ${t.name}`, time:"5–10 min", q:t.q, help:t.help };
}

function makeVocab(rng){
  const words = [
    ["reliable","pålitlig"], ["exhausted","helt slut"], ["confident","självsäker"],
    ["improve","förbättra"], ["avoid","undvika"], ["curious","nyfiken"],
    ["choice","val"], ["challenge","utmaning"], ["notice","lägga märke till"],
    ["friendly","trevlig"], ["quiet","tyst"], ["important","viktig"]
  ];
  const w = pick(rng, words);
  const frame = pick(rng, [
`Word of the day:
${w[0]} = ${w[1]}

Task:
1) Write the word.
2) Choose ONE:
   a) I feel ${w[0]} when __________.
   b) I am not ${w[0]} when __________.
3) Translate ONE sentence to Swedish.`,
`Word of the day:
${w[0]} = ${w[1]}

Task:
Write 3 short sentences with the word:
1) I…
2) You…
3) We…`
  ]);
  return {
    type:"Word of the day",
    time:"5–10 min",
    q:frame,
    help:`Short is fine.
If stuck: give them 3 Swedish ideas, they translate ONE.`
  };
}

// Uppgraderad "Fix" så den tar lite längre (inte 2 sek)
function makeFix(rng){
  const items = [
    {bad:"We was late because the bus was late.", good:"We were late because the bus was late.", focus:"was/were (plural)"},
    {bad:"He don't like school in the morning.", good:"He doesn't like school in the morning.", focus:"don't/doesn't"},
    {bad:"I am agree with you, but it is hard.", good:"I agree with you, but it is hard.", focus:"no 'am' with agree"},
    {bad:"She have a new phone and it are expensive.", good:"She has a new phone and it is expensive.", focus:"has / is"},
    {bad:"Yesterday I go to the store and buy food.", good:"Yesterday I went to the store and bought food.", focus:"past tense"},
    {bad:"In the weekend I played football.", good:"On the weekend I played football.", focus:"on the weekend"},
    {bad:"I very like this song because it's good.", good:"I really like this song because it's good.", focus:"really/very"}
  ];

  const it = pick(rng, items);

  const prompt =
`Fix the sentence (and extend it):

1) Write the correct sentence.
2) What changed? Choose ONE:
   - verb / tense
   - do/does
   - was/were
   - wrong word
3) Write 2 NEW sentences using the same rule (your own ideas).

Optional (if finished):
Write a 2-line dialogue using one of your new sentences.

Sentence to fix:
${it.bad}`;

  const help =
`Suggested fix:
${it.good}

Rule focus:
${it.focus}

Sentence starters (if stuck):
- Today I…
- Yesterday I…
- We are…
- He/She doesn’t…
- Because…`;

  return { type:"Fix + build (mini)", time:"5–10 min", q:prompt, help:help };
}

function makeReading(rng){
  const texts = [
    "Alex checked the time again. The bus was late. He looked at the sky and sighed.",
    "The classroom was quiet. A note was on the desk. No one wanted to touch it.",
    "Mina wanted to focus, but her phone buzzed. She took a deep breath and kept writing."
  ];
  const t = pick(rng, texts);
  const q = pick(rng, [
`Questions:
1) What is happening?
2) How does the person feel?
3) Write ONE next sentence.`,
`Questions:
1) Find one important word.
2) What will happen next? (one sentence)
3) Write a title (3–6 words).`,
`Questions:
1) What is the problem?
2) Copy one sentence from the text.
3) Rewrite that sentence in easier English.`
  ]);
  return {
    type:"Mini reading",
    time:"5–10 min",
    q:`Text:
${t}

${q}`,
    help:`Keep answers short.
If needed: let them answer Q1 in Swedish, then translate 1 sentence.`
  };
}

function makePractical(rng){
  const situations = [
    "You are late. Write a message to your teacher.",
    "You want to ask for help in class.",
    "You want to order food at a café.",
    "You need to ask for directions.",
    "You want to say no politely."
  ];
  const s = pick(rng, situations);
  const frames = [
`Situation:
${s}

Task:
Write 2–3 short sentences.
Use at least ONE of these:
- please
- sorry
- can you…?
- I need…`,
`Situation:
${s}

Task:
Choose A or B:
A) Write a short message (2–3 lines).
B) Write a short dialogue (4 lines).`
  ];
  return {
    type:"Practical English",
    time:"5–10 min",
    q:pick(rng, frames),
    help:`Let them use a template.
Focus on communication, not perfect grammar.`
  };
}

/* ---------- One function to generate a task from an rng ---------- */
function generateTask(rng){
  const chosen = pick(rng, TYPES);
  if (chosen.key === "quick") return makeQuick(rng);
  if (chosen.key === "choose") return makeChoose(rng);
  if (chosen.key === "grammar") return makeGrammar(rng);
  if (chosen.key === "vocab") return makeVocab(rng);
  if (chosen.key === "fix") return makeFix(rng);
  if (chosen.key === "practical") return makePractical(rng);
  return makeReading(rng);
}

/* ---------- Render helpers ---------- */
function renderTask(t){
  document.getElementById("typePill").textContent = `Type: ${t.type}`;
  document.getElementById("timePill").textContent = `Time: ${t.time}`;
  document.getElementById("taskText").textContent = t.q;
  document.getElementById("helpText").textContent = t.help || "";
}

/* ---------- Build "today's task" ---------- */
const todaysTask = generateTask(rngDay);

/* ---------- Header/footer text ---------- */
const months = ["januari","februari","mars","april","maj","juni","juli","augusti","september","oktober","november","december"];
document.getElementById("dateText").textContent =
  `${today.getDate()} ${months[today.getMonth()]} ${today.getFullYear()}`;
document.getElementById("dayInfo").textContent = `Dag ${doy} av 365`;
document.getElementById("seedInfo").textContent =
  `Kod: ${y}-${String(today.getMonth()+1).padStart(2,"0")}-${String(today.getDate()).padStart(2,"0")}`;

/* ---------- Initial render ---------- */
renderTask(todaysTask);

/* ---------- Buttons: extra tasks on the spot ---------- */
// Counter per day (så "Ny uppgift" ger ny varje klick, men samma för alla på samma dator om man vill)
const counterKey = `eng_extra_counter_${y}_${doy}`;
let counter = Number(localStorage.getItem(counterKey) || "0");

document.getElementById("newTaskBtn").addEventListener("click", () => {
  counter += 1;
  localStorage.setItem(counterKey, String(counter));

  // Extra-seed: dagens seed + klickräknare -> nya uppgifter per klick
  const extraSeed = seed * 1000 + counter;
  const rngExtra = mulberry32(extraSeed);

  const extraTask = generateTask(rngExtra);
  renderTask(extraTask);
});

document.getElementById("resetBtn").addEventListener("click", () => {
  renderTask(todaysTask);
});
</script>
</body>
</html>
